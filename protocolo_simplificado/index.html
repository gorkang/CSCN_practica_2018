<!DOCTYPE html>
<html style="height:90%;">

<head>
  <meta charset='UTF-8'>
  <meta name="robots" content="noindex">
  <title>Experimentos CSCN</title>
</head>

<body style="height:100%;text-align:center;">
  <script>
    function partial_shuffle(list, index_start, index_end) {
      if (index_end < list.length && index_start >= 0) {
        var currentIndex = index_end;
        var temporaryValue;
        var randomIndex;
        while (currentIndex !== index_start) {
          randomIndex = Math.floor(Math.random() * currentIndex) + index_start;
          currentIndex -= 1;
          temporaryValue = list[currentIndex];
          list[currentIndex] = list[randomIndex];
          list[randomIndex] = temporaryValue;
        }
      } else {
        throw "Index out of range."
      }
      return (list);
    }

    function shuffle(list) {
      return partial_shuffle(list, 0, list.length - 1);
    }
    var experiments_random = [];
    var experiments = ["informacion_sociodemografica_simple", "bret", "wais_working_memory"];
    experiments = experiments.split(',');
    experiments.reverse();

    var timePassed = true;
    var results = [];
    var gato;

    loaded_once = false;

    function go_fullscreen(event) {
      tries = 4;
      while (tries > 0) {
        if (tries == 4) {
          try {
            document.getElementById("iframe").mozRequestFullScreen();
            tries = 0;
          } catch (error) {
            console.log(error);
          }
        } else if (tries == 3) {
          try {
            document.getElementById("iframe").webkitRequestFullScreen();
            tries = 0;
          } catch (error) {
            console.log(error);
          }
        } else if (tries == 2) {
          try {
            document.getElementById("iframe").msRequestFullscreen();
            tries = 0;
          } catch (error) {
            console.log(error);
          }
        } else if (tries == 1) {
          try {
            document.getElementById("iframe").requestFullscreen();
            tries = 0;
          } catch (error) {
            console.log(error);
          }
        }
        tries -= 1;
      }
      next(event);
    }

    function local_save(csv, name) {
      var blobToSave = new Blob([csv], {
        type: 'text/plain'
      });
      var blobURL = "";
      if (typeof window.webkitURL !== 'undefined') {
        blobURL = window.webkitURL.createObjectURL(blobToSave);
      } else {
        blobURL = window.URL.createObjectURL(blobToSave);
      }
      var link = document.createElement('a');
      link.href = blobURL;
      link.setAttribute('download', name);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function next(event) {
      if (!loaded_once) {
        loaded_once = true;
        window.addEventListener('message', function(message) {
          local_save(message.data.csv, message.data.name + ".csv");
          if (experiments.length > 0)  {
            document.getElementById('iframe').src = "./" + experiments.pop() + "/index.html";
          }
        });
        document.getElementById('iframe').src = "./" + experiments.pop() + "/index.html";
      }
    }
  </script>
  <input type="button" onclick="go_fullscreen(event)" style="margin-top:25%;" value="Comenzar"></input>
  <iframe id="iframe" allowfullscreen=true src="" style="border:none;background:white;" width="100%" height="100%" sandbox="allow-scripts allow-same-origin allow-forms">
  </body>
</html>
